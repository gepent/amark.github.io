---
title: "HTTPS学习"
date: 2019-10-26T19:41:11+08:00
draft: true
categories: ["网络"]
tags: ["HTTPS", "非对称加密", "对称加密", "数字签名"]
description: "series功能"
---


## HTTPS


### 解决的问题
HTTP传输的是明文的，很容易被中间人攻击，为了解决这个问题，在HTTP协议栈(TCP和HTTP之间)引入一个安全层，人们把这种解决方案叫做HTTPS。

![HTTP VS HTTPS](https://ftp.bmp.ovh/imgs/2019/10/de30a15a11b0e4b4.png "HTTP VS HTTPS")

### HTTPS进化的四个阶段

- 对称加密
- 非对称加密
- 对称加密与非对称加密配合
- 数字证书

### 对称加密
![对称加密过程](https://ftp.bmp.ovh/imgs/2019/10/22cee9375ed80bac.jpeg "对称加密过程")
特点：

- 加密和解密都是相同的秘钥
- 有被中间人攻击的风险

**然而怎么解决被攻击的风险呢？**

秘钥线下传输，不能告诉别人，比如约定个会所，秘密协商

这种解决方案适用于用户量小或者协商秘钥的成本不高的情况，比如两个公司对接API，但是对于像淘宝这种，不可能无数个消费者都跑去跟马云到会所喝茶并交换秘钥吧，就算简单一点，比如大家通过微信(一个安全的工具)协商，这样对于用户量很大的企业，成本也是很高的

事实上现实中很多事情都是权衡成本的产物

所以版本一被时代遗弃了

聪明的工程师总是能为行业带来惊喜，于是乎非对称加密呼之欲出

### 非对称加密
![非对称加密过程](https://ftp.bmp.ovh/imgs/2019/10/c98ee1ebd38c28dc.jpeg "非对称加密过程")
特点：

- 有一对秘钥(公钥，私钥)
- 公钥可以公开
- 传输速度慢，算法复杂
- 有被中间人攻击的风险

上面非对称过程图片，服务器发送了公钥，浏览器没有发，这样只加密了客户端的信息，当然如果有需要，服务器发给浏览器的信息也可以通过浏览器的公钥匙进行加密

如果仔细想一下，这个方案中的用于加密的公钥可以公开，对称加密的秘钥不可以公开，事实上公钥公开没有任何相应，但是必须保证这是服务器自己的公钥，这才是关键

有时候吧，人类的智慧就是来源于东拼西凑，为了不断解决上述问题，伟大的工程师就提出把非对称与对称结合的想法

### 对称加密与非对称加密配合
![对称加密与非对称加密结合](https://ftp.bmp.ovh/imgs/2019/10/7637f37b43ea4956.jpeg "对称加密与非对称加密结合")
特点：

- 数据传输过程是对称秘钥
- pre-master从浏览器传到服务器需要服务器公钥加密
- 生成秘钥需要client-random + service-random + pre-master
- 有被中间人攻击的风险

上面三种方案都有被中间人攻击的风险，但是被攻击的难度是逐级增高的，即使是这样还是有被攻击的风险，唉!

感觉搞了半天，仿佛又回到了原点，如果保证“我就是我”的问题，只能找一个权威机构，人们把它叫做CA

### 数字证书
![对称加密与非对称加密加上数字证书](https://ftp.bmp.ovh/imgs/2019/10/c7ca6cdbd23e5a40.jpeg "对称加密与非对称加密加上数字证书")
这个权威机构可以为我们证明自己的身份，就相当于可以证明我们身份的身份证

这样就彻底解决了“我就是我”的问题

从上图我们可以看出，验证完数字证书后面的流程与“对称加密与非对称加密配合”完全一样

到此为止一个结合了"对称加密"、"非对称加密"与"数字证书"三大功能的安全传输方案被推上历史舞台，人们管他叫"HTTPS"


### 如何申请数字证书

假设A网站需要申请数字证书

1. 首先A网站需要准备一套私钥和公钥，私钥留着自己使用
2. 然后A网站向CA机构提交公钥、公司、网站等信息并等待认证
3. CA审核A网站的资料
4. 审核通过后，CA会向A网站签发认证的数字证书，包含：A网站的公钥、组织信息、CA的信息、有效时间、证书序列号等，这些信息都是明文的，同时包含一个CA生成的数字签名


最后一步的数字签名是怎么得到的

1. CA使用Hash函数来计算A网站提交的明文信息，并得到摘要
2. CA再使用它的私钥对摘要进行加密，加密后的密文就是CA颁给A网站的数字签名


